language: php

php:
  - '7.3'
  - '7.2'

dist: xenial

services:
  - mysql

env:
  global:
    - PHALCON_VERSION=4.0.0-beta.2
    - PHALCON_BUILD=754
    - PHALCON_BRANCH=mainline
    - PHALCON_OS=ubuntu/xenial

cache:
  timeout: 604800
  directories:
    - ${HOME}/.composer/cache

install:
  - pecl install --force psr
  - .ci/install-phalcon.sh
  - echo extension=phalcon.so | tee -a "$(phpenv prefix)/etc/php.ini"

before_script:
  - travis_retry composer install --no-interaction --no-ansi --no-progress --no-suggest
  - cp .env.example .env
  - chmod 777 var/cache var/logs

script:
  - vendor/bin/phinx migrate
  - vendor/bin/phinx seed:run
  - vendor/bin/codecept build --quiet
  - vendor/bin/codecept run
  - vendor/bin/psalm

notifications:
  email: false
